
<link rel="import" href="../bower_components/paper-input/paper-input.html">

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/file-fire/file-fire-drop.html">
<link rel="import" href="../bower_components/file-fire/file-fire-fetch.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../bower_components/polymerfire/firebase-auth-script.html">
<link rel="import" href="../bower_components/polymerfire/firebase-database-script.html">
<link rel="import" href="../bower_components/polymerfire/firebase-storage-script.html">
<link rel="import" href="../bower_components/polymerfire/firebase-messaging-script.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">
<script src="../bower_components/time-js/time.js"></script>
<dom-module id="file-fire-drop-multi">
    <template>
        <style>
            :host {
                display: flex;
                flex-direction:column;
            }
            div.carousel {
                display:flex;
                flex-direction:row;
                flex-wrap:wrap;
            }
            file-fire-drop {
                height: 100px;
                width: 100px;
                border-radius: 4px;
                --file-fire-dropzone-background-image: url("http://i.imgur.com/ndcWzqn.png");
            }
        </style>
        <label hidden$="[[!label]]">[[label]]</label>
        <div class="carousel">
            <template is="dom-repeat" items="[[uploadedImages]]">
                <h2>[[item.name]]</h2>
                <img src$="[[item.url]]">
            </template>
            <file-fire-drop app-name="[[appName]]" path="/dropdemo/click" src-file over-write max-dimension="200" resize-height="16" resize-width="16" progress="{{progress}}" placeholder="{{base64}}" files="{{images}}" always-show>
            </file-fire-drop>
        </div>
    </template>
    <script>
        class FileFireDropMulti extends Polymer.Element {
            static get is() { return 'file-fire-drop-multi'; }
            static get properties() {
                return {
                    max_images: {
                        type: Number,
                        reflectToAttribute: true,
                        value: () => 1
                    },
                    uploadedImages: {
                        type: Array
                    },
                    label: {
                        type: String
                    }
                }
            }
            _handleUpload(e) {
                console.log(e);
                this.uploadedImages = e.detail.urls;
            }
            ready() {
                super.ready();
                this.addEventListener('upload', this._handleUpload)
            }
            
        }

    window.customElements.define(FileFireDropMulti.is, FileFireDropMulti);
    </script>
</dom-module>

<dom-module id="time-range-input">
    <template>
        <style>
            :host {
                display:flex;
                padding:10px;
            }
            div {
                display:inherit;
                padding:5px;
                flex-direction:row;
                align-items:flex-end;
            }
            div * {
                padding:3px;
            }
            paper-input {
                width:80px;
            }
            paper-listbox {
                display:flex;
                flex-direction:row;
            }
        </style>
        <div>
            <paper-input type="time" label="Start" value="{{rawStartTime}}"></paper-input>
            <paper-radio-group selected="{{rawStartPeriod}}">
                <paper-radio-button name="AM">AM</paper-radio-button>
                <paper-radio-button name="PM">PM</paper-radio-button>
            </paper-radio-group>
        </div>
        <div>
            <paper-input type="time" label="End" value="{{rawEndTime}}"></paper-input>
            <paper-radio-group selected="{{rawEndPeriod}}">
                <paper-radio-button name="AM">AM</paper-radio-button>
                <paper-radio-button name="PM">PM</paper-radio-button>
            </paper-radio-group>
        </div>
    </template>
    <script>
        class TimeRangeInput extends Polymer.Element {
            static get is () { return 'time-range-input'; }
            static get properties() {
                return {
                    militaryTime: {
                        type: Boolean,
                        value: () => {
                            let lString = (new Date(3600*4*1000).toLocaleString());
                            if(lString.indexOf('AM') != -1 || lString.indexOf('PM') != -1) {
                                return false;
                            } else {
                                return true;
                            }
                        }
                    },
                    rawStartPeriod: {
                        type: String,
                        value: () => "AM"
                    },
                    rawEndPeriod: {
                        type: String,
                        value: () => "PM"
                    },
                    rawStartTime: {
                        type: String,
                        value: () => "09:00",
                        notify: true
                    },
                    rawEndTime: {
                        type: String,
                        value: () => "05:00",
                        notify: true
                    },
                    startTime: {
                        type: String,
                        reflectToAttribute: true,
                        notify: true,
                        computed: 'computeTime(rawStartTime, rawStartPeriod)'
                    },
                    endTime: {
                        type: String,
                        reflectToAttribute: true,
                        notify: true,
                        computed: 'computeTime(rawEndTime, rawEndPeriod)'
                    },
                    name: {
                        type: String,
                        reflectToAttribute: true
                    }
                }
            }
            computeTime(nativeTime, period) {
                if(this.militaryTime) {
                    // ignore period
                    return nativeTime;
                } else {
                    if(period == 'AM') {
                        return nativeTime;
                    } else {
                        // need to actually parse
                        var t = Time(nativeTime);
                        var paddedHours = (t.hours()+12).toString().padStart(2, '0');
                        var paddedMins = (t.minutes()+12).toString().padStart(2, '0');
                        return `${paddedHours}:${paddedMins}`
                    }
                }
            }
        }
        window.customElements.define(TimeRangeInput.is, TimeRangeInput);
    </script>
</dom-module>