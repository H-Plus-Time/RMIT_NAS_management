box:
  id: mhart/alpine-node:latest
  cmd: /bin/sh
build:
  steps:
    - script:
        name: install yarn
        code: |
          apk --no-cache add git && npm install -g yarn
    - script:
        name: set yarn cache
        code: |
          export YARN_CACHE=$WERCKER_CACHE_DIR/yarn
    - script:
        name: install dependencies
        code: |
          HOME=$YARN_CACHE yarn && yarn global add bower polymer-cli
    - script:
        name: bower install
        code: |
          bower install --allow-root --config.interactive=false
    - script:
        name: gen keys
        code: |
          ./key.sh
    - script:
        name: actual build
        code: |
          polymer build
deploy:
  steps:
    - script:
        name: firebase deploy
        code: |
          apk add --no-cache make gcc g++ python
          npm install -g firebase-tools
          firebase deploy --project=nas-app --token "$FIREBASE_TOKEN"
